<dibl-sidebar></dibl-sidebar>

<div id="page-wrapper" class="gray-bg">

    <dibl-header></dibl-header>

    <dibl-toolbar></dibl-toolbar>

    <div class="row inquiry">

        <!-- Module 1-->
        <div class="col-md-7 wrapper wrapper-content animated fadeInpanel-body">
            <div class="ibox-content">
                <div class="heading ng-binding">
                    {{'dibl.inquiry.new-edit.inquiry-metadata' | translate}}
                </div>
                <div class="padding">
                    <div class="ibox-content profile-content">
                        <form role="form">
                            <div class="box-body">
                                <form novalidate>
                                    <div class="form-group">
                                        <label for="gameTitle">{{'dibl.inquiry.new-edit.inquiry-title' |
                                            translate}}</label>
                                        <input required type="name" class="form-control" id="gameTitle"
                                               placeholder="{{'dibl.inquiry.new-edit.inquiry-title-placeholder' | translate}}"
                                               ng-model="game.title">
                                    </div>
                                </form>

                                <label>{{ 'dibl.inquiry.new-edit.inquiry-title' | translate }}</label>
                                <text-angular  ta-toolbar="[
                                    ['bold','italics'],
                                    ['justifyCenter', 'justifyLeft'], ['ul', 'ol'],
                                    ['insertImage', 'insertLink','insertVideo']]
                                    "ng-model="game.description"></text-angular>
                            </div>


                        </form>

                        <div class="pull-right tooltip-demo">
                            <a class="btn btn-white btn-sm" data-toggle="tooltip"
                               data-placement="top" title="Move to draft folder"><i class="fa fa-times"></i>
                                Discard</a>

                            <a class="btn btn-primary btn-sm" data-toggle="tooltip"
                               data-placement="top" ng-click="ok()" title="Save inquiry"><i class="fa fa-check"></i>
                                {{ 'dibl.inquiry.new-edit.inquiry-save' | translate }}</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-5 wrapper wrapper-content animated fadeInpanel-body">
            <div class="ibox-content">
                <div class="heading ng-binding">
                    {{ 'dibl.inquiry.new-edit.inquiry-roles' | translate }}
                </div>
                <div class="padding">
                    <div class="ibox-content profile-content">
                        <!--<h4><strong>{{ 'dibl.inquiry.new-edit.roles-title' | translate }} </strong></h4>-->

                        <p>{{ 'dibl.inquiry.new-edit.p-available-roles' | translate }} <b>{{ game.title }}</b></p>

                        <ul class="tag-list" style="padding: 0; display: inline-block;">
                            <li ng-repeat="role in game.config.roles track by $index"><a href=""  ng-click="selectRole($index)">
                                <i class="fa fa-circle" ng-style="{ 'color': role.color }"></i> {{ role.name }}</a></li>
                            <li ng-show="game.config.roles == 0"><a href=""><i class="fa fa-tag"></i> {{
                                'dibl.inquiry.new-edit.no-roles' | translate }}</a></li>
                        </ul>
                        <br/>



                        <input required type="name" class="form-control" id="roleName"
                                   placeholder="Enter a role"
                                   ng-model="roleName">
                        <br/>

                        <input required type="color" class="form-control" id="roleColor"
                                   placeholder="Enter a role"
                                   ng-model="roleColor">


                        <br/>
                        <!--<p>{{ game.config.roles }}</p>-->

                        <div class="user-button">
                            <div class="row">
                                <div class="col-md-6">
                                    <button type="button" ng-disabled="!roleName" ng-click="addRole()"
                                            class="btn btn-primary btn-sm btn-block"><i
                                            class="fa fa-envelope"></i> {{ 'dibl.inquiry.new-edit.add-role' |
                                        translate }}
                                    </button>
                                </div>
                                <div class="col-md-6">
                                    <button type="button" ng-click="removeRole()"
                                            class="btn btn-default btn-sm btn-block"><i
                                            class="fa fa-coffee"></i> {{ 'dibl.inquiry.new-edit.remove-role' |
                                        translate }}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-12 wrapper wrapper-content animated fadeInpanel-body">
            <div class="ibox-content">
                <div class="heading ng-binding">
                    {{ 'dibl.inquiry.new-edit.inquiry-phases-activities' | translate }}
                </div>
                <div class="padding">
                    <p>{{ 'dibl.inquiry.new-edit.configuration-dashboard' | translate }}</p>
                </div>
                <div class="padding">
                    <div class="col-lg-3 nice-border">
                        <h3>{{ 'dibl.inquiry.new-edit.phases' | translate }}</h3>

                        <div class="input-group">
                            <input type="text" class="form-control" ng-model="phaseName">
                            <span class="input-group-btn">
                                <button
                                        type="button" ng-disabled="phaseName.length < 4 || !phaseName"
                                        ng-click="addPhase()" class="btn btn-success"><i class="fa fa-plus"></i> {{
                                    'dibl.inquiry.new-edit.add-phase' | translate }}
                                </button>
                            </span>
                        </div>

                        <br/>
                        <br/>

                        <h3>{{ 'dibl.inquiry.new-edit.activities' | translate }}</h3>

                        <div id="drag-list">
                            <div class="btn btn-primary dropped" ng-repeat="item in list_original"
                                 ng-model="list_original" data="{{ item.type }}" name="{{ item.name }}"
                                 ng-click="addOne(item)" ng-disabled="phases.length == 0">
                                <i class="fa {{ item.icon }}"></i>
                                {{ item.name }}
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-9">
                        <div class="tabs-container" ng-show="phases == 0" class="tip" style="color: #000; font-size: 18px; text-align: center; padding-top: 53px; width:90%; margin:0 auto; position: absolute;z-index: 1;">
                            {{ 'dibl.inquiry.new-edit.click-first' | translate }}
                            <button class="btn btn-success" ng-click="addPhase()"
                                    style="width: 10em; vertical-align: baseline;"><i class="fa fa-plus"></i> {{
                                'dibl.inquiry.new-edit.add-phase' | translate }}
                            </button>
                            {{ 'dibl.inquiry.new-edit.adding-phases' | translate }}
                        </div>

                        <div class="tabs-container" ng-controller="TabController as tab">
                            <ul class="nav nav-tabs select-activities" ng-model="phases">

                                <li ng-repeat="phase in phases track by $index" ng-class="{ active:tab.isSet($index) }"
                                    data="{{$index}}">

                                    <a data-toggle="tab"
                                       ng-click="tab.setTab($index);changeTab($index)">
                                        <i class="fa fa-arrow-left reorder-phase" ng-click="movePhase($index, $index-1)" ng-hide="$index == 0" title="Move phase {{ $index }} to the left"></i>
                                        <span >{{$index}}. {{ phase.title }}</span>
                                        <!--<i class="fa fa-remove remove-phase" ng-hide="phases.length == 1" ng-click="removePhase($index)"></i>-->
                                        <!--<i class="fa fa-edit edit-phase " title="Rename phase" ng-click="renamePhase(tab.isSet($index), $index)"></i>-->
                                        <i class="fa fa-arrow-right reorder-phase" ng-click="movePhase($index, $index+1)" ng-hide="$index == phases.length-1" title="Move phase {{ $index }} to the right"></i>
                                    </a>
                                </li>
                            </ul>

                            <div class="tab-content">
                                <div class="tab-pane" ng-repeat="phase in phases track by $index"
                                     ng-class="{true: 'active'}[tab.isSet($index) == true]" ng-show="tab.isSet($index)">
                                    <div class="panel-body">
                                        <div class="ibox-title no-borders no-padding">
                                            <h5>List of activities in '{{ phase.title }}' phase</h5>
                                            <div class="ibox-tools">

                                                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                                    <i class="fa fa-edit" title="Rename phase" ng-click="renamePhase(tab.isSet($index), $index)"></i>

                                                </a>
                                                <a class="close-link">
                                                    <i class="fa fa-remove" ng-hide="phases.length == 1" ng-click="removePhase($index)"></i>
                                                </a>
                                            </div>
                                        </div>
                                        <div class="col-lg-3 activities" ng-model="lists[$index]" data="{{$index}}">
                                            <div ng-hide="lists[$index].length > 0" class="tip"
                                                 style="color: #000; font-size: 18px; text-align: center; padding-top: 200px; width:90%; margin:0 auto; position: absolute;z-index: 1;">
                                                {{ 'dibl.inquiry.new-edit.adding-activities' | translate }}
                                                {{$index}}
                                            </div>

                                            <button ng-repeat="combination in combinations" class="btn btn-white"
                                                    ng-model="x" value="{{combination.combinationId}}"
                                                    ng-click="SelectedCombination(combination.combinationId);"
                                                    ng-class="{'btn-primary':selectedCombination==combination.combinationId}"
                                                    type="button">
                                                {{combination.name}}
                                            </button>

                                            <div class="btn btn-success dropped"
                                                 ng-click="selectActivity(item, item.id)"
                                                 ng-repeat="(key, item) in lists[$index] | orderByDayNumber:'sortKey'"
                                                 ng-class="{'btn-warning':selectedCombination==item.id}">
                                                <span ng-show="item.name.length == 0"> <small>No name provided</small> </span>
                                                {{ item.sortKey }}. {{ item.name | limitTo: 15 }}
                                            </div>
                                        </div>

                                        <div class="col-md-9">
                                            <div ng-show="lists[$index].length > 0 && !selectedCombination" class="tip"
                                                 style="color: #000; font-size: 18px; text-align: center; padding-top: 53px; width:90%; margin:0 auto; position: absolute;z-index: 1;">
                                                {{ 'dibl.inquiry.new-edit.editing-activities' | translate }}
                                            </div>
                                            <div class="mail-box" ng-show="selected">

                                                <div class="mail-body" ng-class="{ not_saved: compare() }">
                                                    <form class="form-horizontal" method="get">
                                                        <div class="form-group">
                                                            <label class="col-sm-3 control-label">{{
                                                                'dibl.inquiry.new-edit.title-activity' | translate
                                                                }}</label>

                                                            <div class="col-sm-9">
                                                                <input ng-disabled="activity == null" type="text"
                                                                       ng-model="activity.name"
                                                                       class="form-control">
                                                            </div>
                                                        </div>
                                                        <div class="form-group" ng-hide="true">
                                                            <label class="col-sm-3 control-label">{{
                                                                'dibl.inquiry.new-edit.type-activity' | translate
                                                                }}</label>

                                                            <div class="col-sm-9">
                                                                <input ng-disabled="activity == null" type="text"
                                                                       ng-model="activity.type"
                                                                       class="form-control">
                                                            </div>
                                                        </div>
                                                        <div class="form-group" ng-show="activity.type == 'org.celstec.arlearn2.beans.generalItem.VideoObject'">
                                                            <label class="col-sm-3 control-label">{{
                                                                'dibl.inquiry.new-edit.video-activity' | translate
                                                                }}</label>

                                                            <div class="col-sm-9" >
                                                                <input ng-disabled="activity == null"
                                                                       placeholder="Ex: https://www.youtube.com/embed/4zZbX_9ru9U"
                                                                       type="text"
                                                                       ng-model="activity.videoFeed"
                                                                       class="form-control">
                                                                <span class="help-block m-b-none">Use the embed URL</span>
                                                            </div>
                                                        </div>
                                                        <!--<div class="form-group" ng-show="activity.audioFeed">-->
                                                            <!--<label class="col-sm-3 control-label">{{-->
                                                                <!--'dibl.inquiry.new-edit.google-activity' | translate-->
                                                                <!--}}</label>-->

                                                            <!--<div class="col-sm-9">-->
                                                                <!--<input ng-show="activity.audioFeed"-->
                                                                       <!--ng-disabled="activity == null" type="text"-->
                                                                       <!--placeholder="Audio URL"-->
                                                                       <!--ng-model="activity.audioFeed"-->
                                                                       <!--class="form-control">-->
                                                            <!--</div>-->
                                                        <!--</div>-->
                                                        <div class="form-group">
                                                            <label class="col-sm-3 control-label">{{
                                                                'dibl.inquiry.new-edit.roles-activity' | translate
                                                                }}</label>

                                                            <!-- Roles -->
                                                            <div class="col-sm-9">
                                                                <!--<label class="checkbox-inline" ng-repeat="role in game.config.roles track by $index" >-->
                                                                    <!--<input type="checkbox" ng-change="sync(bool, role)" ng-model="bool" ng-checked="isChecked(role.name)">{{role.name}}-->
                                                                <!--</label>-->
                                                                <select name="repeatSelect" id="repeatSelect" class="form-control" ng-model="data.model">
                                                                    <option ng-repeat="option in game.config.roles track by $index" value="{{option}}">{{option.name}}</option>
                                                                </select>

                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="col-sm-3 control-label">{{
                                                                'dibl.inquiry.new-edit.activity-order' | translate
                                                                }}</label>

                                                            <div class="col-sm-9">
                                                                <input type="number"
                                                                       placeholder="Order"
                                                                       ng-model="activity.sortKey"
                                                                       class="form-control">
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <div class="col-sm-12">
                                                                <text-angular  ta-toolbar="[
                                                                ['bold','italics'],
                                                                ['justifyCenter', 'justifyLeft'], ['ul', 'ol'],
                                                                ['insertImage', 'insertLink','insertVideo']]
                                                                "ng-model="activity.richText"></text-angular>
                                                            </div>
                                                        </div>
                                                        <!--<div class="form-group">-->
                                                            <!--<label class="col-sm-12 control-label">Rich text </label>-->

                                                            <!--<div class="col-sm-12">-->
                                                                <!--<div ng-bind-html="activity.richText"></div>-->
                                                            <!--</div>-->
                                                        <!--</div>-->

                                                        <!--<div class="form-group">-->

                                                            <!--<label class="col-sm-3 control-label">{{-->
                                                                <!--'dibl.inquiry.new-edit.description-activity' | translate-->
                                                                <!--}}</label>-->

                                                            <!--<div class="col-sm-9">-->
                                                                <!--<textarea ng-disabled="activity == null"-->
                                                                          <!--class="form-control"-->
                                                                          <!--ng-model="activity.description"></textarea>-->
                                                            <!--</div>-->
                                                        <!--</div>-->
                                                        <!--<div class="form-group"><label-->
                                                                <!--class="col-sm-2 control-label">{{-->
                                                            <!--'dibl.inquiry.new-edit.roles-activity' | translate-->
                                                            <!--}}</label>-->

                                                            <!--<div class="col-sm-10">-->
                                                                <!--<select ng-disabled="activity == null" multiple chosen-->
                                                                        <!--ng-options="s for s in run.game.config.roles track by $index">-->
                                                                <!--</select>-->
                                                            <!--</div>-->
                                                        <!--</div>-->

                                                    </form>

                                                </div>

                                                <!--<summernote ng-model="activity.description"></summernote>-->


                                                <div class="mail-body text-right tooltip-demo">

                                                    <a ng-click="removeActivity(activity)"
                                                       ng-disabled="activity == null" class="btn btn-danger btn-sm"
                                                       data-toggle="tooltip"
                                                       data-placement="top" title="Discard email"><i
                                                            class="fa fa-times"></i>
                                                        {{ 'dibl.inquiry.new-edit.delete-activity' | translate }}</a>

                                                    <!--<a ng-click="resetActivity()" ng-disabled="!activity.id" class="btn btn-white btn-sm"-->
                                                    <!--data-toggle="tooltip"-->
                                                    <!--data-placement="top" title="Discard email"><i-->
                                                    <!--class="fa fa-times"></i>-->
                                                    <!--Discard</a>-->

                                                    <a ng-click="saveActivity()" ng-disabled="activity == null"
                                                       class="btn btn-sm btn-primary"
                                                       data-toggle="tooltip"
                                                       data-placement="top" title="Send"><i class="fa fa-reply"></i>
                                                        {{ 'dibl.inquiry.new-edit.save-activity' | translate }}</a>
                                                </div>
                                                <div class="clearfix"></div>

                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-12 wrapper wrapper-content animated fadeInpanel-body">
            <div class="ibox-content">
                <div class="heading ng-binding">
                    {{'dibl.inquiry.new-edit.run-inquiries' | translate}}
                </div>
                <div class="padding">
                    <div class="ibox-content profile-content">


                        <div class="col-md-6">
                            <h3>{{'dibl.inquiry.new-edit.run-inquiries-title' | translate}}</h3>

                            <p>{{'dibl.inquiry.new-edit.run-inquiries-description' | translate}}</p>
                        </div>

                        <div class="col-md-6">
                            <h3>{{'dibl.inquiry.new-edit.run-inquiries-subtitle' | translate}}</h3>

                            <div class="input-group">

                                <input type="text" class="form-control" ng-model="run.title">
                            <span class="input-group-btn">
                                <button
                                        type="button" ng-disabled="run.title.length < 4 || !run.title"
                                        ng-click="createInquiryRun()" class="btn btn-success"><i class="fa fa-plus"></i>
                                    Add new inquiry run
                                </button>
                            </span>
                            </div>
                        </div>

                        <div class="project-list">
                            <table class="table table-hover">
                                <tbody>
                                <tr ng-repeat="(key, run) in gameRuns | orderByDayNumber:'serverCreationTime'">
                                    <td class="project-status">
                                        <span ng-show="run.deleted" class="label label-danger">Deleted</span>
                                        <span ng-hide="run.deleted" class="label label-primary">Active</span>
                                    </td>
                                    <td class="project-completion">
                                        <p><b>Code</b></p>
                                        <small>{{ run.code }}</small>
                                        <!--<div class="progress progress-mini">-->
                                        <!--<div style="width: 48%;" class="progress-bar"></div>-->
                                        <!--</div>-->
                                    </td>
                                    <td class="project-title">
                                        <a href="#inquiry/{{ run.runId }}">{{ run.title }}</a>
                                        <br>
                                        <small>Created {{ run.serverCreationTime | date:'medium' }}</small>
                                        <br/>
                                        <small>Modification {{ run.lastModificationDate | date:'medium' }}</small>
                                    </td>
                                    <!--<td class="project-completion">-->
                                        <!--<small>Completion with: 48%</small>-->
                                        <!--<div class="progress progress-mini">-->
                                            <!--<div style="width: 48%;" class="progress-bar"></div>-->
                                        <!--</div>-->
                                    <!--</td>-->
                                    <td class="project-people" data-toggle="tooltip" data-placement="left" title="Tooltip on left">
                                        <a href="#/profile/{{user.accountType}}:{{user.localId}}" ng-repeat="user in usersRun[run.runId]">
                                            <ng-letter-avatar shape="round" ng-if="user.picture == ''" data="{{ user.name }}"></ng-letter-avatar>
                                            <img
                                                alt="{{ user.name }}" title="{{ user.name }}" class="img-circle"
                                                ng-if="user.picture != ''"
                                                ng-src="{{ user.picture }}"></a>
                                    </td>
                                    <td class="project-actions">
                                        <a href="#inquiry/{{ run.runId }}" class="btn btn-white btn-sm"><i
                                                class="fa fa-eye"></i> View </a>
                                        <a ng-click="addUsersToRun(run.runId, run.gameId)"
                                           class="btn btn-white btn-sm"><i class="fa fa-user"></i> Add users </a>
                                        <a href="#/inquiry/{{ run.gameId }}/run/{{ run.runId }}/edit" class="btn btn-white btn-sm"><i
                                                class="fa fa-pencil"></i> Edit </a>
                                        <a ng-click="removeRun(run)" class="btn btn-default btn-sm"><i
                                                class="fa fa-times"></i> Delete </a>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-7 wrapper wrapper-content animated fadeInpanel-body">
            <div class="ibox-content">
                <div class="heading ng-binding">
                    {{'dibl.inquiry.new-edit.editor-management' | translate}}
                </div>
                <div class="padding">
                    <div class="ibox-content profile-content">
                        <div class="project-list">
                            <table class="table table-hover">
                                <tbody>

                                    <tr ng-repeat="(key, account) in accountsAccesGame">
                                        <td class="project-status">
                                            <span ng-show="account.accessRights == 2" class="label label-primary">User</span>
                                            <span ng-show="account.accessRights == 1" class="label label-danger">Editor</span>
                                        </td>
                                        <td class="client-avatar">
                                            <ng-letter-avatar shape="round" ng-if="account.picture == ''" data="{{ account.name }}"></ng-letter-avatar>
                                            <img alt="{{ account.name }}" title="{{ account.name }}" class="img-circle"
                                                ng-if="account.picture != ''"
                                                ng-src="{{ account.picture }}"></a>
                                        </td>
                                        <td><a data-toggle="tab" href="#contact-1" class="client-link">{{ account.name }}</a></td>
                                        <td class="contact-type"><i class="fa fa-envelope"> </i></td>
                                        <td> {{ account.email }}</td>
                                        <td class="project-actions">
                                            <a ng-show="account.accessRights == 2 && me.localId != account.localId" ng-click="grantEditorAccess(game, account)"
                                               class="btn btn-white btn-sm"><i class="fa fa-arrow-up"></i> Promote to editor </a>
                                            <a ng-show="account.accessRights == 1 && me.localId != account.localId" ng-click="revokeEditorAccess(game, account)"
                                               class="btn btn-white btn-sm"><i class="fa fa-arrow-down"></i> Relegate to user </a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                        </div>
                    </div>
                </div>
            </div>
        </div>



        <div class="col-md-5 wrapper wrapper-content animated fadeInpanel-body" ng-show="myAccount.accountLevel == 1">
            <div class="ibox-content">
                <div class="heading ng-binding">
                    {{'dibl.inquiry.new-edit.export-import' | translate}}
                </div>
                <div class="padding">
                    <div class="ibox-content profile-content">

                        <textarea ui-codemirror ui-codemirror-opts="editorOptions2" ng-model="gameModel.value">

                        </textarea>
                    </div>
                </div>
            </div>
        </div>

        <dibl-footer></dibl-footer>

    </div>
</div>